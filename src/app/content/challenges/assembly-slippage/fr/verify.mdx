import { ChallengeTitle } from "../../../../components/Challenges/ChallengeTitle";
import { RequirementList } from "../../../../components/Challenges/RequirementList";
import { Requirement } from "../../../../components/Challenges/Requirement";

<ChallengeTitle>Glissement sBPF en Assembly</ChallengeTitle>

Maintenant que vous devriez commencer à être à l'aise avec l'écriture en Assembly, au lieu d'utiliser simplement un compte normal, votre vérification de glissement devrait fonctionner à la fois pour les comptes SPL-Token et Token2022.

> Le `amount` sera placé en mémoire à la même constante que dans l'exemple. La principale différence est que nous ne pouvons pas obtenir les données d'instruction en utilisant une constante puisque la `data_len` du compte est dynamique (les données d'instruction sont situées à la fin des données du dernier compte).

Créez un programme qui n'a qu'une seule instruction. Il doit :
- Prendre un seul compte Token SPL ou Token2022
- Prendre un u64 (8 octets) de solde minimum dans les données d'instruction
- Calculer dynamiquement le décalage vers le solde minimum
- Si le glissement est dépassé, journaliser la chaîne `Slippage exceeded` et renvoyer le code d'erreur 1

> Pour obtenir le bon décalage des données d'instruction, vous pouvez utiliser notre [outil](https://sbpf.xyz). Mais nous allons vous aider : la `data_len` du compte token se trouve à `.equ TOKEN_ACCOUNT_DATA_LEN, 0x0058`

Commencez par installer le package sBPF comme expliqué dans la [section outillage](/en/courses/introduction-to-assembly/tooling) du cours Introduction à l'Assembly et compilez votre programme en utilisant la commande suivante dans votre terminal :

```
sbpf build
```

Cela générera un fichier `.so` dans votre dossier `target/deploy`. 

Maintenant, cliquez sur le bouton `take challenge` et déposez-y le fichier !

<RequirementList>
  <Requirement title="Défi 1 : Tester le glissement avec SPL-Token">
    Votre programme devrait réussir lorsque le montant de jetons dans un compte SPL-Token est supérieur au montant passé en paramètre.
  </Requirement>

  <Requirement title="Défi 2 : Tester l'échec d'un glissement">
    Votre programme doit échouer lorsque le montant de jetons dans un compte de jetons est inférieur au montant transmis.
  </Requirement>

  <Requirement title="Défi 3 : Tester le glissement avec Token2022">
    Votre programme doit réussir lorsque le montant de jetons dans un compte Token2022 est supérieur au montant transmis.
  </Requirement>
</RequirementList>