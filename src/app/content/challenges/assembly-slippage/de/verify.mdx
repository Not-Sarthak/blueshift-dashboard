import { ChallengeTitle } from "../../../../components/Challenges/ChallengeTitle";
import { RequirementList } from "../../../../components/Challenges/RequirementList";
import { Requirement } from "../../../../components/Challenges/Requirement";

<ChallengeTitle>sBPF Assembly Slippage</ChallengeTitle>

Jetzt, da du dich langsam mit dem Schreiben von Assembly vertraut machen solltest, sollte deine Slippage-Prüfung sowohl für SPL-Token als auch für Token2022-Konten funktionieren, anstatt nur ein normales Konto zu verwenden.

> Die `amount` wird im Speicher an derselben Konstante wie im Beispiel platziert. Der Hauptunterschied besteht darin, dass wir die Instruktionsdaten nicht mit einer Konstante abrufen können, da die `data_len` des Kontos dynamisch ist (Instruktionsdaten befinden sich am Ende der letzten Kontodaten).

Erstelle ein Programm, das nur eine Anweisung hat. Es muss:
- Ein einzelnes SPL- oder Token2022-Token-Konto aufnehmen
- Ein u64 (8-Byte) Mindestguthaben in den Instruktionsdaten aufnehmen
- Den Offset zum Mindestguthaben dynamisch berechnen
- Wenn der Slippage überschritten wird, den String `Slippage exceeded` loggen und Fehlercode 1 zurückgeben

> Um den richtigen Offset für die Instruktionsdaten zu erhalten, kannst du unser [Tool](https://sbpf.xyz) verwenden. Aber wir helfen dir: die `data_len` des Token-Kontos befindet sich bei `.equ TOKEN_ACCOUNT_DATA_LEN, 0x0058`

Beginne mit der Installation des sBPF-Pakets, wie im [Tooling-Abschnitt](/de/courses/introduction-to-assembly/tooling) des Kurses "Einführung in Assembly" erklärt, und erstelle dein Programm mit dem folgenden Befehl in deinem Terminal:

```
sbpf build
```

Dies generiert eine `.so`-Datei in deinem `target/deploy`-Ordner. 

Klicke jetzt auf die Schaltfläche `take challenge` und ziehe die Datei dort hinein!

<RequirementList>
  <Requirement title="Challenge 1: Testen des Slippage mit SPL-Token">
    Dein Programm sollte erfolgreich sein, wenn die Tokenmenge in einem SPL-Token-Konto höher ist als die übergebene Menge.
  </Requirement>

  <Requirement title="Herausforderung 2: Testen des Fehlschlags eines Slippage">
    Ihr Programm sollte fehlschlagen, wenn die Tokenmenge in einem Token-Konto niedriger ist als die übergebene Menge.
  </Requirement>

  <Requirement title="Herausforderung 3: Testen des Slippage mit Token2022">
    Ihr Programm sollte erfolgreich sein, wenn die Tokenmenge in einem Token2022-Konto höher ist als die übergebene Menge.
  </Requirement>
</RequirementList>